FROM node:24-slim
RUN rm /bin/sh && ln -s /bin/bash /bin/sh
RUN apt-get update
RUN apt-get install -y curl git

WORKDIR /usr/src/app

# Copy package files first for better caching
COPY package*.json ./

# Install dependencies
RUN npm i

# Copy the rest of the application
COPY . .

# Install Playwright browsers
RUN npx playwright install --with-deps

# Set CI environment variable
ENV CI=true

# Run tests
CMD ["npm", "run", "test"]
